# 项目报告

- [项目报告](#项目报告)
  - [1 数据存储及优化对比](#1-数据存储及优化对比)
    - [1.1 关系型数据库](#11-关系型数据库)
      - [1.1.1 适用查询范围](#111-适用查询范围)
      - [1.1.2 存储优化工作](#112-存储优化工作)
      - [1.1.3 优化前后对比](#113-优化前后对比)
    - [1.2 分布式数据库](#12-分布式数据库)
      - [1.2.1 适用查询范围](#121-适用查询范围)
      - [1.2.2 存储优化工作](#122-存储优化工作)
      - [1.2.3 优化前后对比](#123-优化前后对比)
    - [1.3 图数据库](#13-图数据库)
      - [1.3.1 适用查询范围](#131-适用查询范围)
      - [1.3.2 存储优化工作](#132-存储优化工作)
      - [1.3.3 优化前后对比](#133-优化前后对比)
  - [2 数据质量保证](#2-数据质量保证)
    - [2.1 保证数据质量方法](#21-保证数据质量方法)
      - [2.1.1 数据爬取](#211-数据爬取)
      - [2.1.2 数据清洗](#212-数据清洗)
    - [2.2 数据质量影响因素](#22-数据质量影响因素)
  - [3 数据血缘使用场景](#3-数据血缘使用场景)
    - [3.1 场景概述](#31-场景概述)
    - [3.2 项目应用](#32-项目应用)
  - [4 小组贡献度](#4-小组贡献度)

## 1 数据存储及优化对比

### 1.1 关系型数据库

#### 1.1.1 适用查询范围

关系型数据库在**高效管理与查询结构化数据**时表现良好，可以应对需要复杂查询与严格处理的场景，适用于好确保数据一致性与完整性的应用。

- 关系型数据库所管理的数据通常以表格形式存在，这类数据具有固定结构和明确字段定义，高度结构化。每一行代表一个记录，每列代表一种属性，这种清晰的数据组织方式使得关系型数据库能够高效地存储和检索信息。但是使用时需要定义好表与表中字段，数据结构固定不易调整。本次项目中由于需要进行存储优化，需要经常调整数据库结构，也因此需要更新或重新导入相关数据，在处理一些数据库表时较为麻烦。

- 关系型数据库在执行复杂的SQL查询方面表现出色，尤其是在涉及多个表之间的联接操作时。此外，关系型数据库还允许编写嵌套的子查询来实现复杂的业务逻辑，能够通过聚合函数对数据进行统计分析。配合上 `GROUP BY` 语句，还可以实现对数据的分组统计。这些功能可以较为灵活简单地完成数据分析等工作。

- 关系型数据库还提供了 `ACID` 事务特性，保证了数据的完整性与一致性。在进行复杂查询或事务处理时，可以确保数据结构的清晰性与可维护性。适合于金融交易、电子商务等对数据准确性和安全性有极高要求的领域，确保了即使在复杂的业务环境中也能保持数据的完整性和可靠性。

#### 1.1.2 存储优化工作

在本次项目中，我们通过对物理模型的反规范化、预聚合以及设置冗余存储等操作对存储进行了优化。

**1. 星型模型**

本次项目采用星型模型结构，在数据存储上我们通过引入一定的数据冗余，换取了更好的查询性能。通过围绕事实表 `Movie` 建立一系列的维度表，将 `Movie` 的属性拆分到不同维度表中，简化了查询的复杂度，优化了查询的性能。

**2. 字段设置**

在 `Review` 表中，我们将记录评论时间信息的 `time` 时间戳字段的类型设计为了 `bigint`，而不是常见的 `datetime` 类型。这一决策主要基于以下考量：
- **平台兼容性**：采用 `bigint` 类型确保了数据能在不同数据库系统与编程语言之间保持一致性与互操作性。
- **空间效率**：相较于 `datetime` 类型，`bigint` 所需的存储空间更小，这对于规模较大的评论表 `Review` 而言尤为重要，能够有效降低存储成本。

而在 `Movie` 表中，我们将评分相关的 `imdb_score` 字段设计为了 `float` 类型，这样的选择主要出于如下考量：
- **节省资源**：相较与 `double` 类型，`float` 所占用的存储空间更小，有助于优化存储资源的利用。
- **精度适配**：考虑到电影评分并不需要较高的数值精度，`float` 类型足以满足需求，也可以避免不必要的复杂性。

**3. 冗余存储**

在电影表中，我们添加了 `review_num` 评论数量字段，通过添加这一冗余存储，避免在查询最受欢迎的演员组合时与评论表进行联接操作，从而提升查询性能。

此外我们将电影的发布时间单独抽象为一张表，将电影的发布时间拆分为多个字段，而不是直接存储电影发布时间的时间戳，这样在分别根据年、月、日查询电影时，可以减少对数据的处理，简化了操作流程，也提高了查询的性能。

**4. 反规范化与预聚合**
。。。
TODO：预聚合建立对应的表与存储过程

#### 1.1.3 优化前后对比

（选择一个比较的示例，可以是评论相关的，评论表规模较大，进行优化后效果可能更为显著）

### 1.2 分布式数据库

#### 1.2.1 适用查询范围

分布式数据库专注于处理大规模数据和高并发访问，适用于需要高可用性和横向扩展的场景，如大数据处理、分布式日志存储和互联网应用。

**主要功能优势：**

- **扩展性强**：支持水平扩展，允许数据分布在多个节点上并在多个节点并行处理查询，从而提高系统的吞吐量和性能。特别是在库表分布于不同节点时，分布式数据库能高效地处理分布式事务，确保数据的一致性和完整性。

- **负载均衡**：通过负载均衡机制动态分配查询压力，确保每个节点都在其容量范围内运行，同时优化查询执行计划以高效利用分布式环境的计算资源。

- **高效索引**：支持在不同节点上创建和维护索引，有效减少数据传输，提高查询效率。这对于分布式查询尤为重要。

- **容错性高**：具备备容错能力，在节点故障或网络中断的情况下，系统能够继续运行。这包括数据备份和故障转移等机制，保证系统的高可用性。

- **容量弹性**：支持在不同物理设备间存储数据，通过增加节点解决容量瓶颈，实现系统的横向扩展。

#### 1.2.2 存储优化工作

- 将关系型数据库中的视图转为实际表，不仅复用了原有代码，还减少了演员与演员、演员与导演之间的连接操作，从而加速了查询。
- 采用与关系型数据库相同的表结构，通过引入冗余字段避免了复杂的连接操作，并设置了相同的索引以优化查询性能。
- 通过建立外部表来管理存储在外部的数据，数据库仅保存元数据，而实际数据存储在文件系统中。这种方法允许在数据存储位置直接进行查询，减少了数据的传输，提高了查询效率，避免了数据移动可能带来的性能瓶颈。

#### 1.2.3 优化前后对比

> 若不将视图建立为实际的表，则在分布式数据库中会出现更多的join操作，拖慢了查询的速度，在将视图建立为实际表后，速度加快了约5秒，下图是加快后的结果，查询时间为12.523s.

### 1.3 图数据库

#### 1.3.1 适用查询范围

图数据库专注于处理**图形化数据**，主要用于节点和边之间关系的高效处理，能够灵活支持复杂关系型数据的查询，尤其在面对大量、复杂、动态的网状数据时表现出色。同时，图数据库具备实时增删改查、可视化、高可用和备份恢复功能，并严格遵循 ACID 事务特性。

**主要功能优势：**

- **复杂关系查询**：图数据库能够快速处理复杂节点间的关系，如查找邻居节点或共同连接点。在项目中，当查询演员与导演之间的关系时，关系型数据库通常逻辑复杂且效率较低，而图数据库能以简单的查询语句快速、高效地获取节点之间的关系。

- **路径发现**：支持查找任意两个节点之间的最短路径，并集成多种图算法，能够有效分析图中关键节点、社区结构，应用于路径规划、网络分析及依赖关系分析等场景。

- **递归查询**：图数据库支持递归查询，便于追踪节点到自身的路径，这在存储和处理复杂关系数据时非常高效，传统关系型数据库难以轻松实现这一功能，尤其在查找自循环关系时，图数据库更具优势。

#### 1.3.2 存储优化工作

**1. 存储字段选择**

- 在数据库中只存储**4类节点**（演员、导演、电影、电影类型）以及**3种关系**（导演与电影间的执导关系、演员与电影之间的参演关系、电影类型的拥有关系），便于查询时快速进行计算。
- 在数据库中电影节点中存储电影相关的评论数，便于统计。

**2. 建立索引**

- 对查询时4类节点中将会用到的字段建立索引，分别是演员名、演员名、电影名、电影风格

#### 1.3.3 优化前后对比

> 建立图数据库索引可以加速图数据库关系的査询，左图是添加索引之前，查询演员之间的关系耗时为4.776秒，右图是添加索引之后，查询演员之间的关系耗时2.335秒。


## 2 数据质量保证

### 2.1 保证数据质量方法

#### 2.1.1 数据爬取

1. 使用爬虫获取数据时：
   - 采用 `selenium` 模拟浏览器操作。
   - 使用 `amazoncaptcha` 库处理验证码并执行反爬操作。
   - 爬取一定数量后更换 IP 地址（尝试建立代理池，但免费代理质量较差，因此手动切换代理节点）。
   - 手动更换 `cookie`。
   - 小组成员之间采用多种方式爬取数据，互相补充以确保完整的网页数据，避免信息遗漏。

2. 只爬取 `movies` 和 `TV` 分类的数据，后续筛掉 `TV` 数据。

3. 对爬取到的 404 网页进行标记。

4. 使用 `xpath` 从网页中提取数据，同时规避网页结构变化导致数据提取失效。

#### 2.1.2 数据清洗

1. 将组员之间的数据按 ANSI 进行 `merge` 操作，整理成完整数据，避免数据遗漏。

2. 删除明显错误数据，包括仅有电影 ID 且其他字段为空的数据。

3. 去除人名中的错误字符（如双引号等）。

4. 删除数据集中与 `movie` 无关的数据：
   - 优先处理电影评论集，只保留包含关键词 `film`/`movie` 的数据。
   - 删除电影名称中包含 `season` 或 `episode` 的数据。

5. 使用评论数据集中最早的评论时间补充丢失的部分电影上映时间。

6. 统一人名的不同表示形式。

7. 对电影数据去重：
   - 对电影名和导演相同即视为同一部电影。
   - 保留去重数据中的第一项，并将其标记为最终版本。

### 2.2 数据质量影响因素

1. **网页结构及关键信息命名差异**  
   网页结构或命名的差异可能导致爬取数据不完整或出现错误，直接影响数据质量。

2. **单一数据源的局限性**  
   数据主要来源于单一平台，因平台信息本身不完整且未完全使用第三方数据源补充（如豆瓣和 TMDB），受到接口请求限制或数据重复爬取的影响，导致数据质量受损。

3. **数据库设计缺陷**  
   数据库设计可能存在不足，导致数据在录入时无法有效校验，出现数据重复或不完整的情况。

4. **反爬机制影响**  
   Amazon 的反爬机制对爬虫工作构成阻碍，尽管已解决验证码问题，但部分页面的 detail 数据被隐藏，导致需要重新爬取，影响数据完整性。

5. **网络不稳定性**  
   网络连接的不稳定或中断可能导致爬取过程中的部分数据丢失。

6. **数据模型和格式差异**  
   不同数据源的数据模型和格式不一致，需要进行转换和验证，但转换过程中可能进一步影响数据质量。

7. **数据处理环节问题**  
   数据清洗、转换和装载过程中，可能因逻辑混乱而引发数据丢失、重复或失真等问题。此外，在更新和重处理数据时，也可能因人为偏差造成数据质量问题。

## 3 数据血缘使用场景

数据血缘是一种记录和追踪数据流动路径的技术，用于了解数据在整个信息系统中的传递、转换和处理过程，广泛应用于数据治理、质量管理和风险控制等领域。

### 3.1 场景概述

1. **数据质量管理**  
   数据血缘可用于监控和评估数据质量，通过追踪数据流动路径，快速定位数据质量问题的根本原因和发生位置，便于实时修复与改进。

2. **合规性和审计**  
   在遵循法规和行业标准的场景下，数据血缘能够追踪敏感数据的处理路径，确保数据处理的合规性。同时，审计人员可借助数据血缘验证数据准确性和完整性，提升数据可信度。

3. **数据治理**  
   数据血缘是数据治理中的关键部分，可帮助识别数据生成、修改和使用的全流程。通过清晰的数据追踪，支持数据治理政策、标准化规则的制定和执行。

4. **故障排查和性能优化**  
   当数据处理链路中发生故障或性能下降时，数据血缘能够协助快速识别问题根源，通过追踪数据流路径，优化处理节点或排除系统故障，提高整体性能。

5. **变更管理**  
   当数据架构或处理逻辑需要调整时，数据血缘可评估变更的影响范围，确保变更过程中的风险最小化。

6. **数据资产管理**  
   数据血缘有助于全面了解数据资产的流转路径，支持资源分配优化。它可以帮助识别哪些数据资源被频繁使用，哪些资源被闲置，以实现更高效的数据管理。

7. **数据安全**  
   数据血缘能追踪敏感数据的流动路径，帮助明确敏感数据的暴露风险并加强安全防护。同时，可追踪数据泄露事件的源头并快速采取应对措施。

8. **业务影响分析**  
   在业务变更或系统升级时，数据血缘能够分析变更对下游业务流程的影响，支持变更方案的制定与实施，从而最大限度降低业务风险。

### 3.2 项目应用

TODO。。。

## 4 小组贡献度

| 学号    | 姓名   | 百分比 |
| ------- | ------ | ------ |
| 2253721 | 陈茁扬 | 25%    |
| 2254198 | 段子涛 | 25%    |
| 2251528 | 王浩然 | 25%    |
| 2253206 | 韩明洋 | 25%    |
